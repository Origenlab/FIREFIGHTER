---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Breadcrumbs from '../../../components/layout/Breadcrumbs.astro';
import Badge from '../../../components/ui/Badge.astro';
import Button from '../../../components/ui/Button.astro';
import JsonLd from '../../../components/seo/JsonLd.astro';
import { getCollection, render } from 'astro:content';
import states from '../../../data/states.json';

export async function getStaticPaths() {
  const allStations = await getCollection('stations');

  return allStations.map((station) => {
    const stationSlug = station.id.split('/').pop()?.replace('.md', '') || '';

    // Get related stations (same state, excluding current)
    const relatedStations = allStations
      .filter(s => s.data.stateSlug === station.data.stateSlug && s.id !== station.id)
      .slice(0, 5);

    return {
      params: {
        state: station.data.stateSlug,
        station: stationSlug,
      },
      props: { station, relatedStations, allStations },
    };
  });
}

const { station, relatedStations, allStations } = Astro.props;
const { data } = station;
const { Content } = await render(station);

const state = states.find((s) => s.slug === data.stateSlug);
const currentStationSlug = station.id.split('/').pop()?.replace('.md', '') || '';
const siteUrl = 'https://firefighter.com.mx';
const canonicalUrl = `${siteUrl}/directorio/${data.stateSlug}/${currentStationSlug}`;

// Calculate nearby stations by distance
function getDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {
  const R = 6371; // Earth's radius in km
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
    Math.sin(dLon/2) * Math.sin(dLon/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c;
}

// Get nearest stations (from all states)
const nearbyStations = allStations
  .filter(s => s.id !== station.id)
  .map(s => ({
    ...s,
    distance: getDistance(data.latitude, data.longitude, s.data.latitude, s.data.longitude)
  }))
  .sort((a, b) => a.distance - b.distance)
  .slice(0, 3);

const serviceTypeLabels: Record<string, string> = {
  'profesional': 'Profesional',
  'voluntario': 'Voluntario',
  'industrial': 'Industrial',
  'aeroportuario': 'Aeroportuario',
  'proteccion-civil': 'Protección Civil',
};

const serviceLabels: Record<string, string> = {
  'combate-incendios': 'Combate de Incendios',
  'atencion-medica': 'Atención Médica',
  'rescate-vehicular': 'Rescate Vehicular',
  'rescate-acuatico': 'Rescate Acuático',
  'materiales-peligrosos': 'Materiales Peligrosos (Hazmat)',
  'rescate-alturas': 'Rescate en Alturas',
  'proteccion-civil': 'Protección Civil',
  'capacitacion': 'Capacitación',
  'prevencion': 'Prevención',
};

// Google Maps URL
const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${data.latitude},${data.longitude}`;

// SEO: Generate rich keywords
const servicesText = data.services.map(s => serviceLabels[s] || s).join(', ');
const seoKeywords = [
  'bomberos',
  'estación de bomberos',
  data.municipality,
  data.city,
  data.state,
  'emergencias',
  '911',
  'incendios',
  'rescate',
  data.neighborhood || '',
  serviceTypeLabels[data.serviceType] || '',
].filter(Boolean).join(', ');

// Enhanced SEO meta description
const enhancedDescription = data.metaDescription ||
  `${data.name} en ${data.neighborhood ? data.neighborhood + ', ' : ''}${data.municipality}, ${data.city}. ` +
  `Tel: ${data.phone}. Servicios: ${servicesText.substring(0, 60)}. ` +
  `Horario: ${data.operatingHours}. Emergencias: 911.`;

// Schema.org FireStation - Enhanced
const fireStationSchema = {
  "@context": "https://schema.org",
  "@type": "FireStation",
  "@id": canonicalUrl,
  "name": data.name,
  "alternateName": data.stationCode,
  "description": enhancedDescription,
  "url": canonicalUrl,
  "telephone": data.phone,
  "email": data.email || undefined,
  "address": {
    "@type": "PostalAddress",
    "streetAddress": data.address,
    "addressLocality": data.municipality,
    "addressRegion": data.state,
    "postalCode": data.postalCode || "",
    "addressCountry": "MX",
    "areaServed": {
      "@type": "City",
      "name": data.city
    }
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": data.latitude,
    "longitude": data.longitude
  },
  "hasMap": mapsUrl,
  "openingHoursSpecification": {
    "@type": "OpeningHoursSpecification",
    "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
    "opens": "00:00",
    "closes": "23:59"
  },
  "foundingDate": data.yearEstablished ? String(data.yearEstablished) : undefined,
  "numberOfEmployees": data.totalPersonnel ? {
    "@type": "QuantitativeValue",
    "value": data.totalPersonnel
  } : undefined,
  "knowsAbout": data.services.map(s => serviceLabels[s] || s),
  "publicAccess": true,
  "isAccessibleForFree": true,
  "currenciesAccepted": "MXN",
  "paymentAccepted": "Emergency services are free",
  "priceRange": "Gratuito",
  "image": `${siteUrl}/images/og-station-default.jpg`,
  "sameAs": data.website ? [data.website] : [],
  "potentialAction": {
    "@type": "ReserveAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": `tel:${data.phone}`,
      "actionPlatform": ["http://schema.org/IOSPlatform", "http://schema.org/AndroidPlatform"]
    },
    "result": {
      "@type": "Reservation",
      "name": "Llamar a la estación"
    }
  },
  "aggregateRating": data.verified ? {
    "@type": "AggregateRating",
    "ratingValue": "5",
    "ratingCount": "1",
    "bestRating": "5",
    "worstRating": "1"
  } : undefined
};

// Schema.org BreadcrumbList
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Inicio",
      "item": siteUrl
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Directorio",
      "item": `${siteUrl}/directorio`
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": state?.name || data.state,
      "item": `${siteUrl}/directorio/${data.stateSlug}`
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": data.name,
      "item": canonicalUrl
    }
  ]
};

// Schema.org FAQPage - For emergency reporting section
const faqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "¿Cuál es el número de emergencias para bomberos en México?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "El número de emergencias es el 911. Este número es gratuito y funciona desde cualquier teléfono fijo o celular en todo México."
      }
    },
    {
      "@type": "Question",
      "name": `¿Cuál es el teléfono de la ${data.name}?`,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": `El teléfono directo de la ${data.name} es ${data.phone}. También puedes llamar al 911 para emergencias.`
      }
    },
    {
      "@type": "Question",
      "name": `¿Dónde está ubicada la ${data.name}?`,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": `La ${data.name} está ubicada en ${data.address}, ${data.neighborhood ? data.neighborhood + ', ' : ''}${data.municipality}, ${data.city}, ${data.state}, C.P. ${data.postalCode || 'N/A'}.`
      }
    },
    {
      "@type": "Question",
      "name": `¿Cuál es el horario de la ${data.name}?`,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": `La ${data.name} opera las ${data.operatingHours}, los 365 días del año para atender emergencias.`
      }
    },
    {
      "@type": "Question",
      "name": `¿Qué servicios ofrece la ${data.name}?`,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": `La ${data.name} ofrece los siguientes servicios: ${servicesText}.`
      }
    }
  ]
};

// Schema.org LocalBusiness (combined for better local SEO)
const localBusinessSchema = {
  "@context": "https://schema.org",
  "@type": "GovernmentService",
  "name": data.name,
  "serviceType": "Servicios de Emergencia y Bomberos",
  "provider": {
    "@type": "GovernmentOrganization",
    "name": `Heroico Cuerpo de Bomberos de ${data.city}`,
    "areaServed": {
      "@type": "City",
      "name": data.city,
      "containedIn": {
        "@type": "State",
        "name": data.state
      }
    }
  },
  "areaServed": {
    "@type": "City",
    "name": data.municipality,
    "containedIn": {
      "@type": "State",
      "name": data.state
    }
  },
  "availableChannel": {
    "@type": "ServiceChannel",
    "serviceUrl": canonicalUrl,
    "servicePhone": data.phone,
    "availableLanguage": {
      "@type": "Language",
      "name": "Spanish"
    }
  }
};
---

<BaseLayout
  title={data.metaTitle || `${data.name} | Bomberos ${data.city}`}
  description={enhancedDescription}
  canonicalUrl={canonicalUrl}
>
  <!-- SEO: Geo Meta Tags for Local Search -->
  <meta slot="head" name="geo.region" content={`MX-${data.stateSlug.toUpperCase().substring(0, 3)}`} />
  <meta slot="head" name="geo.placename" content={`${data.municipality}, ${data.city}`} />
  <meta slot="head" name="geo.position" content={`${data.latitude};${data.longitude}`} />
  <meta slot="head" name="ICBM" content={`${data.latitude}, ${data.longitude}`} />

  <!-- SEO: Keywords -->
  <meta slot="head" name="keywords" content={seoKeywords} />

  <!-- SEO: Additional Meta Tags -->
  <meta slot="head" name="author" content="Firefighter México" />
  <meta slot="head" name="publisher" content="Firefighter México" />
  <meta slot="head" name="coverage" content="México" />
  <meta slot="head" name="distribution" content="global" />
  <meta slot="head" name="rating" content="general" />
  <meta slot="head" name="revisit-after" content="7 days" />

  <!-- SEO: Place/Location Tags (for Apple Maps, etc) -->
  <meta slot="head" property="place:location:latitude" content={String(data.latitude)} />
  <meta slot="head" property="place:location:longitude" content={String(data.longitude)} />

  <!-- Schema.org JSON-LD: FireStation (Primary) -->
  <script type="application/ld+json" set:html={JSON.stringify(fireStationSchema)} />

  <!-- Schema.org JSON-LD: BreadcrumbList -->
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />

  <!-- Schema.org JSON-LD: FAQPage -->
  <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />

  <!-- Schema.org JSON-LD: GovernmentService -->
  <script type="application/ld+json" set:html={JSON.stringify(localBusinessSchema)} />

  <div class="bg-slate-50 min-h-screen">
    <div class="container-custom py-8">
      <Breadcrumbs
        items={[
          { label: 'Directorio', href: '/directorio' },
          { label: state?.name || data.state, href: `/directorio/${data.stateSlug}` },
          { label: data.name },
        ]}
      />

      <!-- Header -->
      <div class="card p-6 md:p-8 mb-6">
        <div class="flex flex-wrap items-start justify-between gap-4 mb-6">
          <div>
            <div class="flex flex-wrap gap-2 mb-3">
              <Badge variant={data.status === 'activa' ? 'success' : 'slate'}>
                {data.status === 'activa' ? 'Activa' : data.status}
              </Badge>
              <Badge variant="fire">
                {serviceTypeLabels[data.serviceType] || data.serviceType}
              </Badge>
              {data.verified && (
                <Badge variant="info">Verificada</Badge>
              )}
            </div>
            <h1 class="text-2xl md:text-3xl font-display font-bold text-slate-800 mb-2">
              {data.name}
            </h1>
            <p class="text-fire-600 font-medium">
              {data.municipality}, {data.city} — {data.state}
            </p>
          </div>

          <div class="flex gap-3">
            <a
              href={`tel:${data.phone}`}
              class="btn btn-primary"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
              </svg>
              Llamar
            </a>
            <a
              href={mapsUrl}
              target="_blank"
              rel="noopener noreferrer"
              class="btn btn-outline"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              Cómo llegar
            </a>
          </div>
        </div>

        <div class="flex items-start gap-2 text-slate-600">
          <svg class="w-5 h-5 mt-0.5 flex-shrink-0 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
          </svg>
          <span>{data.address}{data.neighborhood ? `, ${data.neighborhood}` : ''}{data.postalCode ? `, C.P. ${data.postalCode}` : ''}</span>
        </div>
      </div>

      <div class="grid lg:grid-cols-3 gap-6">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-6">
          <!-- Map Placeholder -->
          <div class="card overflow-hidden">
            <div class="aspect-video bg-slate-200 relative">
              <iframe
                src={`https://www.openstreetmap.org/export/embed.html?bbox=${data.longitude-0.01}%2C${data.latitude-0.01}%2C${data.longitude+0.01}%2C${data.latitude+0.01}&layer=mapnik&marker=${data.latitude}%2C${data.longitude}`}
                class="w-full h-full border-0"
                loading="lazy"
                title={`Mapa de ${data.name}`}
              ></iframe>
            </div>
            <div class="p-4 bg-slate-50 flex items-center justify-between">
              <span class="text-sm text-slate-500">
                Coordenadas: {data.latitude.toFixed(4)}, {data.longitude.toFixed(4)}
              </span>
              <a
                href={mapsUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="text-sm text-fire-600 hover:text-fire-700 font-medium"
              >
                Abrir en Google Maps →
              </a>
            </div>
          </div>

          <!-- Services -->
          <div class="card p-6">
            <h2 class="text-xl font-display font-semibold text-slate-800 mb-4">
              Servicios
            </h2>
            <div class="grid sm:grid-cols-2 gap-3">
              {data.services.map((service) => (
                <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg">
                  <div class="w-8 h-8 bg-fire-100 rounded-lg flex items-center justify-center">
                    <svg class="w-4 h-4 text-fire-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                  </div>
                  <span class="text-slate-700 font-medium text-sm">
                    {serviceLabels[service] || service}
                  </span>
                </div>
              ))}
            </div>
          </div>

          <!-- Content from Markdown - Enhanced Design -->
          <div class="station-content">
            <Content />
          </div>
        </div>

        <!-- Sidebar - Refined Design -->
        <div class="space-y-4">

          <!-- Quick Stats - Compact -->
          <div class="card p-4">
            <h3 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3">Datos Clave</h3>
            <div class="grid grid-cols-2 gap-3">
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-fire-50 rounded-md flex items-center justify-center">
                  <svg class="w-4 h-4 text-fire-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                </div>
                <div>
                  <div class="text-sm font-semibold text-slate-800">{data.operatingHours}</div>
                  <div class="text-xs text-slate-400">Horario</div>
                </div>
              </div>
              {data.yearEstablished && (
                <div class="flex items-center gap-2">
                  <div class="w-8 h-8 bg-gold-50 rounded-md flex items-center justify-center">
                    <svg class="w-4 h-4 text-gold-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                  </div>
                  <div>
                    <div class="text-sm font-semibold text-slate-800">{data.yearEstablished}</div>
                    <div class="text-xs text-slate-400">Fundación</div>
                  </div>
                </div>
              )}
              {data.totalPersonnel && (
                <div class="flex items-center gap-2">
                  <div class="w-8 h-8 bg-blue-50 rounded-md flex items-center justify-center">
                    <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                  </div>
                  <div>
                    <div class="text-sm font-semibold text-slate-800">{data.totalPersonnel}</div>
                    <div class="text-xs text-slate-400">Personal</div>
                  </div>
                </div>
              )}
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-green-50 rounded-md flex items-center justify-center">
                  <svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                </div>
                <div>
                  <div class="text-sm font-semibold text-green-600">{data.status === 'activa' ? 'Activa' : data.status}</div>
                  <div class="text-xs text-slate-400">Estado</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Equipment - Compact -->
          {data.equipment && (
            <div class="card p-4">
              <h3 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3">Flota Vehicular</h3>
              <div class="space-y-2">
                {data.equipment.fireTrucks > 0 && (
                  <div class="flex items-center justify-between py-2 px-3 bg-slate-50 rounded-lg">
                    <div class="flex items-center gap-2">
                      <div class="w-6 h-6 bg-fire-100 rounded flex items-center justify-center">
                        <svg class="w-3.5 h-3.5 text-fire-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"></path>
                        </svg>
                      </div>
                      <span class="text-sm text-slate-700">Motobombas</span>
                    </div>
                    <span class="text-sm font-bold text-fire-600">{data.equipment.fireTrucks}</span>
                  </div>
                )}
                {data.equipment.ambulances > 0 && (
                  <div class="flex items-center justify-between py-2 px-3 bg-slate-50 rounded-lg">
                    <div class="flex items-center gap-2">
                      <div class="w-6 h-6 bg-blue-100 rounded flex items-center justify-center">
                        <svg class="w-3.5 h-3.5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                      </div>
                      <span class="text-sm text-slate-700">Ambulancias</span>
                    </div>
                    <span class="text-sm font-bold text-blue-600">{data.equipment.ambulances}</span>
                  </div>
                )}
                {data.equipment.rescueVehicles > 0 && (
                  <div class="flex items-center justify-between py-2 px-3 bg-slate-50 rounded-lg">
                    <div class="flex items-center gap-2">
                      <div class="w-6 h-6 bg-gold-100 rounded flex items-center justify-center">
                        <svg class="w-3.5 h-3.5 text-gold-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
                        </svg>
                      </div>
                      <span class="text-sm text-slate-700">Rescate</span>
                    </div>
                    <span class="text-sm font-bold text-gold-600">{data.equipment.rescueVehicles}</span>
                  </div>
                )}
              </div>
            </div>
          )}

          <!-- Contact - Refined -->
          <div class="card p-4">
            <h3 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3">Contacto</h3>
            <div class="space-y-2">
              <a href={`tel:${data.phone}`} class="flex items-center gap-3 p-2.5 bg-fire-50 rounded-lg border border-fire-100 hover:border-fire-200 transition-colors group">
                <div class="w-8 h-8 bg-fire-500 rounded-md flex items-center justify-center">
                  <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                  </svg>
                </div>
                <div class="flex-1 min-w-0">
                  <div class="text-xs text-fire-600">Principal</div>
                  <div class="text-sm font-medium text-slate-800 truncate">{data.phone}</div>
                </div>
              </a>

              {data.adminPhone && (
                <a href={`tel:${data.adminPhone}`} class="flex items-center gap-3 p-2.5 hover:bg-slate-50 rounded-lg transition-colors">
                  <div class="w-8 h-8 bg-slate-100 rounded-md flex items-center justify-center">
                    <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                    </svg>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="text-xs text-slate-400">Administrativo</div>
                    <div class="text-sm text-slate-700 truncate">{data.adminPhone}</div>
                  </div>
                </a>
              )}

              {data.email && (
                <a href={`mailto:${data.email}`} class="flex items-center gap-3 p-2.5 hover:bg-slate-50 rounded-lg transition-colors">
                  <div class="w-8 h-8 bg-slate-100 rounded-md flex items-center justify-center">
                    <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                    </svg>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="text-xs text-slate-400">Email</div>
                    <div class="text-sm text-slate-700 truncate">{data.email}</div>
                  </div>
                </a>
              )}

              {data.website && (
                <a href={data.website} target="_blank" rel="noopener noreferrer" class="flex items-center gap-3 p-2.5 hover:bg-slate-50 rounded-lg transition-colors">
                  <div class="w-8 h-8 bg-slate-100 rounded-md flex items-center justify-center">
                    <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"></path>
                    </svg>
                  </div>
                  <div class="flex-1">
                    <div class="text-xs text-slate-400">Sitio web</div>
                    <div class="text-sm text-fire-600">Visitar →</div>
                  </div>
                </a>
              )}
            </div>
          </div>

          <!-- Location - Refined -->
          <div class="card p-4">
            <h3 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3">Ubicación</h3>
            <div class="space-y-3 text-sm">
              <div>
                <div class="text-xs text-slate-400 mb-0.5">Dirección</div>
                <div class="text-slate-700">{data.address}</div>
              </div>
              {data.neighborhood && (
                <div>
                  <div class="text-xs text-slate-400 mb-0.5">Colonia</div>
                  <div class="text-slate-700">{data.neighborhood}</div>
                </div>
              )}
              <div class="flex gap-4">
                <div class="flex-1">
                  <div class="text-xs text-slate-400 mb-0.5">Alcaldía</div>
                  <div class="text-slate-700">{data.municipality}</div>
                </div>
                {data.postalCode && (
                  <div>
                    <div class="text-xs text-slate-400 mb-0.5">C.P.</div>
                    <div class="text-slate-700">{data.postalCode}</div>
                  </div>
                )}
              </div>
              <div class="pt-2 border-t border-slate-100">
                <div class="text-xs text-slate-400 mb-1">Coordenadas</div>
                <div class="font-mono text-xs text-slate-500 bg-slate-50 rounded px-2 py-1.5">
                  {data.latitude.toFixed(6)}, {data.longitude.toFixed(6)}
                </div>
              </div>
              <a
                href={mapsUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="flex items-center justify-center gap-2 w-full py-2.5 bg-slate-800 hover:bg-slate-700 text-white text-sm font-medium rounded-lg transition-colors"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                </svg>
                Ver en Google Maps
              </a>
            </div>
          </div>

          <!-- Verification Badge - Compact -->
          {data.verified && (
            <div class="card p-3 bg-green-50 border-green-100">
              <div class="flex items-center gap-2">
                <div class="w-7 h-7 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0">
                  <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                </div>
                <div class="flex-1 min-w-0">
                  <div class="text-sm font-medium text-green-800">Información Verificada</div>
                  {data.lastUpdated && (
                    <div class="text-xs text-green-600">Actualizado: {data.lastUpdated}</div>
                  )}
                </div>
              </div>
            </div>
          )}

          <!-- Nearby Stations - Refined -->
          {nearbyStations.length > 0 && (
            <div class="card p-4">
              <h3 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3">Estaciones Cercanas</h3>
              <div class="space-y-2">
                {nearbyStations.map((nearbyStation) => {
                  const slug = nearbyStation.id.split('/').pop()?.replace('.md', '');
                  return (
                    <a
                      href={`/directorio/${nearbyStation.data.stateSlug}/${slug}`}
                      class="flex items-center gap-2.5 p-2.5 bg-slate-50 rounded-lg hover:bg-fire-50 border border-transparent hover:border-fire-100 transition-all group"
                    >
                      <div class="w-7 h-7 bg-fire-100 rounded flex items-center justify-center flex-shrink-0 group-hover:bg-fire-200">
                        <svg class="w-3.5 h-3.5 text-fire-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"></path>
                        </svg>
                      </div>
                      <div class="flex-1 min-w-0">
                        <div class="text-sm text-slate-700 group-hover:text-fire-600 truncate">
                          {nearbyStation.data.name}
                        </div>
                        <div class="text-xs text-slate-400">{nearbyStation.data.municipality}</div>
                      </div>
                      <div class="text-xs font-semibold text-fire-600 whitespace-nowrap">
                        {nearbyStation.distance.toFixed(1)} km
                      </div>
                    </a>
                  );
                })}
              </div>
            </div>
          )}

          <!-- Other Stations in State - Refined -->
          {relatedStations.length > 0 && (
            <div class="card p-4">
              <h3 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3">Más en {state?.name || data.state}</h3>
              <div class="space-y-1">
                {relatedStations.map((relStation) => {
                  const slug = relStation.id.split('/').pop()?.replace('.md', '');
                  return (
                    <a
                      href={`/directorio/${relStation.data.stateSlug}/${slug}`}
                      class="flex items-center gap-2 px-2 py-1.5 rounded hover:bg-slate-50 transition-colors group"
                    >
                      <svg class="w-3 h-3 text-slate-300 group-hover:text-fire-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                      </svg>
                      <span class="text-sm text-slate-600 group-hover:text-fire-600 truncate">
                        {relStation.data.name}
                      </span>
                    </a>
                  );
                })}
              </div>
              <a
                href={`/directorio/${data.stateSlug}`}
                class="block mt-3 text-center text-xs text-fire-600 hover:text-fire-700 font-medium"
              >
                Ver todas las estaciones →
              </a>
            </div>
          )}

          <!-- Emergency CTA - Refined -->
          <div class="card p-4 bg-gradient-to-br from-fire-600 to-fire-700 text-white text-center">
            <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
              </svg>
            </div>
            <h3 class="font-semibold mb-1">¿Emergencia?</h3>
            <p class="text-fire-100 text-xs mb-3">No pierdas tiempo</p>
            <a
              href="tel:911"
              class="flex items-center justify-center gap-2 w-full py-3 bg-white text-fire-600 font-bold rounded-lg hover:bg-fire-50 transition-colors"
            >
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
              </svg>
              Llamar al 911
            </a>
          </div>

          <!-- Report Info - Minimal -->
          <div class="text-center py-2">
            <a href="/agregar-estacion" class="text-xs text-slate-400 hover:text-fire-600 transition-colors">
              ¿Información incorrecta? Ayúdanos a corregirla
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</BaseLayout>

<style is:global>
  /* Station Content - Enhanced Design System */
  .station-content {
    background: white;
    border-radius: 1rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    overflow: hidden;
  }

  /* Main Section Headers (H2) - Fire Red Headers */
  .station-content h2 {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-family: 'Space Grotesk', sans-serif;
    font-weight: 700;
    font-size: 1.25rem;
    color: white;
    background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
    padding: 1rem 1.5rem;
    margin: 0;
    border-top: 1px solid #fecaca;
  }

  .station-content h2:first-of-type {
    border-top: none;
    border-radius: 1rem 1rem 0 0;
  }

  .station-content h2::before {
    content: '';
    width: 2rem;
    height: 2rem;
    border-radius: 0.5rem;
    background-color: rgba(255, 255, 255, 0.2);
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='white' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z'/%3E%3C/svg%3E");
    background-size: 1.25rem;
    background-position: center;
    background-repeat: no-repeat;
    flex-shrink: 0;
  }

  /* Content Sections */
  .station-content > p,
  .station-content > ul,
  .station-content > ol,
  .station-content > table,
  .station-content > blockquote {
    padding: 0 1.5rem;
    margin-top: 1rem;
    margin-bottom: 1rem;
  }

  /* H2 Section Wrappers */
  .station-content h2 + p,
  .station-content h2 + ul,
  .station-content h2 + h3 {
    padding-top: 1.5rem;
  }

  /* Subsection Headers (H3) */
  .station-content h3 {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-family: 'Space Grotesk', sans-serif;
    font-weight: 600;
    font-size: 1.125rem;
    color: #1e293b;
    padding: 0 1.5rem;
    margin: 1.5rem 0 1rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #fecaca;
  }

  .station-content h3::before {
    content: '';
    width: 1.5rem;
    height: 1.5rem;
    border-radius: 0.375rem;
    background-color: #fee2e2;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23dc2626' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M9 5l7 7-7 7'/%3E%3C/svg%3E");
    background-size: 0.875rem;
    background-position: center;
    background-repeat: no-repeat;
    flex-shrink: 0;
  }

  /* Paragraphs */
  .station-content p {
    color: #475569;
    line-height: 1.75;
    padding-left: 1.5rem;
    padding-right: 1.5rem;
  }

  .station-content p strong {
    color: #1e293b;
    font-weight: 600;
  }

  /* Unordered Lists - Card Style */
  .station-content ul {
    list-style: none;
    padding: 0 1.5rem;
    margin: 1rem 0;
  }

  .station-content ul li {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    margin-bottom: 0.5rem;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border-radius: 0.5rem;
    border: 1px solid #e2e8f0;
    transition: all 0.2s ease;
  }

  .station-content ul li:hover {
    background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
    border-color: #fecaca;
    transform: translateX(4px);
  }

  .station-content ul li::before {
    content: '';
    width: 1.25rem;
    height: 1.25rem;
    border-radius: 0.25rem;
    background-color: #dc2626;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='white' stroke-width='3'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M5 13l4 4L19 7'/%3E%3C/svg%3E");
    background-size: 0.75rem;
    background-position: center;
    background-repeat: no-repeat;
    flex-shrink: 0;
    margin-top: 0.125rem;
  }

  .station-content ul li strong {
    color: #b91c1c;
    font-weight: 600;
  }

  /* Ordered Lists - Numbered Steps */
  .station-content ol {
    list-style: none;
    padding: 0 1.5rem;
    margin: 1rem 0;
    counter-reset: step-counter;
  }

  .station-content ol li {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem 1.25rem;
    margin-bottom: 0.75rem;
    background: white;
    border-radius: 0.75rem;
    border: 1px solid #e2e8f0;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    counter-increment: step-counter;
    transition: all 0.2s ease;
  }

  .station-content ol li:hover {
    border-color: #fecaca;
    box-shadow: 0 4px 6px rgba(220, 38, 38, 0.1);
  }

  .station-content ol li::before {
    content: counter(step-counter);
    min-width: 2rem;
    height: 2rem;
    border-radius: 9999px;
    background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
    color: white;
    font-weight: 700;
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .station-content ol li strong {
    color: #1e293b;
    font-weight: 600;
  }

  /* Tables - Professional Design */
  .station-content table {
    width: calc(100% - 3rem);
    margin: 1.5rem;
    border-collapse: separate;
    border-spacing: 0;
    border-radius: 0.75rem;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .station-content thead {
    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
  }

  .station-content th {
    color: white;
    font-family: 'Space Grotesk', sans-serif;
    font-weight: 600;
    font-size: 0.875rem;
    text-align: left;
    padding: 0.875rem 1rem;
    border-bottom: 2px solid #475569;
  }

  .station-content th:first-child {
    border-radius: 0.75rem 0 0 0;
  }

  .station-content th:last-child {
    border-radius: 0 0.75rem 0 0;
  }

  .station-content tbody tr {
    background: white;
    transition: all 0.15s ease;
  }

  .station-content tbody tr:nth-child(even) {
    background: #f8fafc;
  }

  .station-content tbody tr:hover {
    background: #fef2f2;
  }

  .station-content td {
    padding: 0.875rem 1rem;
    font-size: 0.875rem;
    color: #475569;
    border-bottom: 1px solid #e2e8f0;
  }

  .station-content tbody tr:last-child td {
    border-bottom: none;
  }

  .station-content td:first-child {
    font-weight: 500;
    color: #1e293b;
  }

  .station-content td strong {
    color: #dc2626;
    font-weight: 600;
  }

  /* Horizontal Rules - Styled Dividers */
  .station-content hr {
    border: none;
    height: 1px;
    background: linear-gradient(to right, transparent, #cbd5e1, transparent);
    margin: 2rem 1.5rem;
  }

  /* Blockquotes - Callout Cards */
  .station-content blockquote {
    position: relative;
    background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
    border-left: 4px solid #f59e0b;
    border-radius: 0 0.75rem 0.75rem 0;
    padding: 1.25rem 1.5rem;
    margin: 1.5rem;
    color: #78350f;
    font-style: italic;
  }

  .station-content blockquote::before {
    content: '"';
    position: absolute;
    top: -0.5rem;
    left: 0.75rem;
    font-size: 3rem;
    color: #fcd34d;
    font-family: Georgia, serif;
    line-height: 1;
  }

  .station-content blockquote p {
    padding: 0;
    margin: 0;
  }

  /* Emphasis/Italic - Footer Notes */
  .station-content > p > em:only-child,
  .station-content > p:last-of-type em {
    display: block;
    font-style: normal;
    font-size: 0.875rem;
    color: #64748b;
    padding: 1rem 1.5rem;
    background: #f8fafc;
    border-top: 1px solid #e2e8f0;
    margin: 1.5rem -1.5rem -1rem -1.5rem;
  }

  /* Code/Technical */
  .station-content code {
    background: #f1f5f9;
    color: #dc2626;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    font-family: 'SF Mono', Monaco, monospace;
  }

  /* Links */
  .station-content a {
    color: #dc2626;
    text-decoration: underline;
    text-decoration-color: #fecaca;
    text-underline-offset: 2px;
    transition: all 0.15s ease;
  }

  .station-content a:hover {
    color: #b91c1c;
    text-decoration-color: #dc2626;
  }

  /* Last element padding */
  .station-content > *:last-child {
    padding-bottom: 1.5rem;
    margin-bottom: 0;
  }

  /* Em dash separator styling */
  .station-content li strong + text,
  .station-content li strong ~ * {
    color: #64748b;
  }
</style>
