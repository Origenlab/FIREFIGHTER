---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumbs from '../../components/layout/Breadcrumbs.astro';
import Badge from '../../components/ui/Badge.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

const formatDate = (date: Date) => {
  return date.toLocaleDateString('es-MX', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
};
---

<BaseLayout
  title={post.data.title}
  description={post.data.description}
  image={post.data.image}
  type="article"
>
  <article class="section bg-slate-50">
    <div class="container-custom">
      <div class="max-w-3xl mx-auto">
        <Breadcrumbs
          items={[
            { label: 'Blog', href: '/blog' },
            { label: post.data.title },
          ]}
        />

        <header class="mb-8">
          <div class="flex flex-wrap gap-2 mb-4">
            {post.data.tags.map((tag) => (
              <Badge variant="fire" size="sm">{tag}</Badge>
            ))}
          </div>

          <h1 class="text-3xl md:text-4xl font-display font-bold text-slate-800 mb-4">
            {post.data.title}
          </h1>

          <p class="text-xl text-slate-600 mb-6">
            {post.data.description}
          </p>

          <div class="flex items-center gap-4 text-sm text-slate-500">
            <span>Por {post.data.author}</span>
            <span>•</span>
            <time datetime={post.data.pubDate.toISOString()}>
              {formatDate(post.data.pubDate)}
            </time>
          </div>
        </header>

        {post.data.image && (
          <img
            src={post.data.image}
            alt={post.data.imageAlt || post.data.title}
            class="w-full rounded-xl mb-8"
          />
        )}

        <div class="card p-8 md:p-12">
          <div class="prose prose-lg prose-slate max-w-none">
            <Content />
          </div>
        </div>

        <footer class="mt-8 pt-8 border-t border-slate-200">
          <a href="/blog" class="btn btn-outline">
            ← Volver al blog
          </a>
        </footer>
      </div>
    </div>
  </article>
</BaseLayout>

<style>
  .prose h2 {
    @apply text-2xl font-display font-semibold text-slate-800 mt-8 mb-4;
  }

  .prose h3 {
    @apply text-xl font-display font-semibold text-slate-700 mt-6 mb-3;
  }

  .prose p {
    @apply text-slate-600 mb-4 leading-relaxed;
  }

  .prose ul, .prose ol {
    @apply space-y-2 mb-6 pl-6;
  }

  .prose li {
    @apply text-slate-600;
  }

  .prose strong {
    @apply text-slate-800;
  }

  .prose a {
    @apply text-fire-600 hover:text-fire-700 underline;
  }

  .prose blockquote {
    @apply border-l-4 border-fire-500 pl-6 italic text-slate-600 my-6;
  }
</style>
